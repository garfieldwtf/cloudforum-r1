<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>CloudForum - Complete Admin System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root{
            --bg:#f5f7fb;
            --text:#222;
            --card-bg:#fff;
            --accent:#2b90ff;
            --danger:#e04;
            --border:#e1e6ef;
        }
        .dark-mode{
            --bg:#0f1720;
            --text:#e6eef8;
            --card-bg:#0b1220;
            --border:#16202b;
        }
        *{box-sizing:border-box;font-family:Inter,Segoe UI,Roboto,Arial,sans-serif}
        body{margin:0;background:var(--bg);color:var(--text);min-height:100vh}
        .container{max-width:1000px;margin:0 auto;padding:18px}
        header{background:transparent;padding:18px 0}
        .header-content{display:flex;align-items:center;justify-content:space-between;gap:12px}
        header h1{margin:0;font-size:1.25rem;display:flex;align-items:center;gap:8px}
        .header-actions{display:flex;align-items:center;gap:12px}
        .btn{background:var(--card-bg);border:1px solid var(--border);padding:8px 10px;border-radius:6px;cursor:pointer;color:var(--text)}
        .btn:hover{opacity:.95}
        .btn-success{background:linear-gradient(180deg,var(--accent),#006de6);color:#fff;border:0}
        .btn-danger{background:var(--danger);color:#fff;border:0}
        .theme-toggle{display:flex;align-items:center;gap:8px}
        .profile-menu{position:relative;cursor:pointer}
        .profile-dropdown{display:none;position:absolute;right:0;top:100%;background-color:var(--card-bg);min-width:160px;box-shadow:0 8px 16px rgba(0,0,0,0.08);z-index:2;border-radius:4px;border:1px solid var(--border);margin-top:8px}
        .profile-dropdown a{display:block;padding:8px 10px;color:var(--text);text-decoration:none}
        .profile-menu:hover .profile-dropdown{display:block}
        .forum-stats{display:flex;gap:12px;margin:18px 0}
        .stat{background:var(--card-bg);padding:12px;border-radius:8px;border:1px solid var(--border);flex:1;text-align:center}
        .stat-number{font-weight:700;font-size:1.1rem}
        .admin-panel{background:var(--card-bg);padding:12px;border-radius:8px;border:1px solid var(--border);margin-bottom:18px}
        .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.35);z-index:10}
        .modal-content{background:var(--card-bg);padding:18px;border-radius:8px;border:1px solid var(--border);width:100%;max-width:520px;box-shadow:0 10px 30px rgba(0,0,0,0.08)}
        .close{float:right;cursor:pointer}
        .form-group{margin-bottom:12px}
        input[type="text"],input[type="password"],input[type="email"],textarea,select{width:100%;padding:8px;border:1px solid var(--border);border-radius:6px;background:transparent;color:var(--text)}
        .notification{position:fixed;right:18px;top:18px;padding:10px 14px;border-radius:6px;display:none;z-index:20}
        .notification.success{background:#0b8; color:#042;}
        .notification.error{background:#fdd; color:#600}

        .thread {
            padding: 10px;
            border: 1px solid var(--border);
            margin-bottom: 8px;
            border-radius: 6px;
            background: var(--card-bg);
        }

        .user-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .user-list li {
            margin-bottom: 8px;
            padding: 8px;
            border: 1px solid var(--border);
            border-radius: 4px;
            background: var(--card-bg);
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.7;
            margin-top: 4px;
        }

        .admin-section {
            margin-bottom: 18px;
        }

        .admin-section h3 {
            margin-top: 0;
            margin-bottom: 12px;
        }

        .admin-section h4 {
            margin-bottom: 8px;
        }

        /* Theme toggle slider */
        .theme-switch {
            position: relative;
            display: inline-block;
            width: 34px;
            height: 18px;
        }

        .theme-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 18px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 14px;
            width: 14px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #2196F3;
        }

        input:checked + .slider:before {
            transform: translateX(16px);
        }

        @media (max-width:768px){.header-content{flex-direction:column;align-items:flex-start}.forum-stats{flex-direction:column}}
    </style>
</head>
<body>
    <div class="notification" id="notification"></div>

    <!-- Modals -->
    <div id="login-modal" class="modal" aria-hidden="true">
        <div class="modal-content">
            <span class="close" id="close-login">&times;</span>
            <h2><i class="fas fa-sign-in-alt"></i> Login</h2>
            <form id="login-form">
                <div class="form-group"><input type="email" id="login-email" placeholder="Email" required></div>
                <div class="form-group"><input type="password" id="login-password" placeholder="Password" required></div>
                <div style="display:flex;gap:8px;justify-content:flex-end">
                    <button type="button" class="btn" id="cancel-login">Cancel</button>
                    <button type="submit" class="btn btn-success">Login</button>
                </div>
            </form>
        </div>
    </div>

    <div id="register-modal" class="modal" aria-hidden="true">
        <div class="modal-content">
            <span class="close" id="close-register">&times;</span>
            <h2><i class="fas fa-user-plus"></i> Register</h2>
            <form id="register-form">
                <div class="form-group"><input type="text" id="register-username" placeholder="Username" required></div>
                <div class="form-group"><input type="email" id="register-email" placeholder="Email" required></div>
                <div class="form-group"><input type="password" id="register-password" placeholder="Password" required></div>
                <div style="display:flex;gap:8px;justify-content:flex-end">
                    <button type="button" class="btn" id="cancel-register">Cancel</button>
                    <button type="submit" class="btn btn-success">Register</button>
                </div>
            </form>
        </div>
    </div>

    <div id="profile-modal" class="modal" aria-hidden="true">
        <div class="modal-content">
            <span class="close" id="close-profile">&times;</span>
            <h2><i class="fas fa-user"></i> Edit Profile</h2>
            <form id="profile-form">
                <div class="form-group"><input type="text" id="profile-username" placeholder="Display name"></div>
                <div class="form-group"><input type="email" id="profile-email" placeholder="Email"></div>
                <div style="display:flex;gap:8px;justify-content:flex-end">
                    <button type="button" class="btn" id="cancel-profile">Cancel</button>
                    <button type="submit" class="btn btn-success">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Header -->
    <header>
        <div class="container header-content">
            <h1><i class="fas fa-database"></i> CloudForum R1</h1>
            <div class="header-actions">
                <div class="theme-toggle" title="Toggle theme">
                    <i class="fas fa-sun"></i>
                    <label class="theme-switch" style="display:inline-flex;align-items:center;gap:6px">
                        <input type="checkbox" id="theme-toggle">
                        <span class="slider" style="width:34px;height:18px;display:inline-block;border-radius:18px;background:#ccc"></span>
                    </label>
                    <i class="fas fa-moon"></i>
                </div>

                <span id="user-greeting" style="display:none">
                    <div class="profile-menu">
                        Welcome, <strong id="username-display"></strong>
                        <div class="profile-dropdown" id="profile-dropdown">
                            <a id="profile-link"><i class="fas fa-user"></i> Profile</a>
                            <a id="logout-link"><i class="fas fa-sign-out-alt"></i> Logout</a>
                        </div>
                    </div>
                </span>

                <button type="button" class="btn" id="login-btn"><i class="fas fa-user"></i> Login</button>
                <button type="button" class="btn" id="register-btn"><i class="fas fa-user-plus"></i> Register</button>
                <button type="button" class="btn btn-success" id="admin-btn" style="display:none"><i class="fas fa-cog"></i> Admin</button>
            </div>
        </div>
    </header>

    <main class="container">
        <div class="forum-stats" aria-hidden="false">
            <div class="stat"><div class="stat-number" id="threads-count">0</div><div class="stat-label">Threads</div></div>
            <div class="stat"><div class="stat-number" id="posts-count">0</div><div class="stat-label">Posts</div></div>
            <div class="stat"><div class="stat-number" id="users-count">0</div><div class="stat-label">Users</div></div>
            <div class="stat"><div class="stat-number" id="online-count">1</div><div class="stat-label">Online</div></div>
        </div>

        <div id="admin-panel" class="admin-panel" style="display:none">
            <h2><i class="fas fa-cog"></i> Admin Panel</h2>
            <div class="admin-section">
                <h3>User Management</h3>
                <div class="form-group">
                    <label>Items per page</label>
                    <select id="users-per-page"><option>5</option><option selected>10</option><option>25</option></select>
                </div>
                <h4>All Users</h4>
                <ul class="user-list" id="user-list" style="padding-left:18px"></ul>
            </div>
        </div>

        <div class="forum-header"></div>
        <div class="thread-list" id="thread-list"></div>
        <div id="thread-view" class="thread-view"></div>
    </main>

    <footer class="container" style="padding:12px 18px;text-align:center;color:var(--text);opacity:.7">
        CloudForum R1 — demo
    </footer>

    <script>
        const API_BASE = 'https://forum-api.garf.workers.dev'; // keep if used by backend calls
        let currentUser = null;
        let users = [];
        let threads = [];
        // DOM refs
        const notif = document.getElementById('notification');
        const loginModal = document.getElementById('login-modal');
        const registerModal = document.getElementById('register-modal');
        const profileModal = document.getElementById('profile-modal');
        const loginBtn = document.getElementById('login-btn');
        const registerBtn = document.getElementById('register-btn');
        const closeLogin = document.getElementById('close-login');
        const closeRegister = document.getElementById('close-register');
        const closeProfile = document.getElementById('close-profile');
        const cancelLogin = document.getElementById('cancel-login');
        const cancelRegister = document.getElementById('cancel-register');
        const cancelProfile = document.getElementById('cancel-profile');
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const profileForm = document.getElementById('profile-form');
        const usernameDisplay = document.getElementById('username-display');
        const userGreeting = document.getElementById('user-greeting');
        const logoutLink = document.getElementById('logout-link');
        const profileLink = document.getElementById('profile-link');
        const adminBtn = document.getElementById('admin-btn');
        const adminPanel = document.getElementById('admin-panel');
        const usersPerPageSelect = document.getElementById('users-per-page');
        const userListEl = document.getElementById('user-list');
        const themeToggle = document.getElementById('theme-toggle');

        function showNotification(msg, success=true){
            notif.textContent = msg;
            notif.className = 'notification ' + (success ? 'success' : 'error');
            notif.style.display = 'block';
            clearTimeout(notif._t);
            notif._t = setTimeout(()=> notif.style.display='none', 3500);
        }

        function openModal(modal){ modal.style.display='flex'; modal.setAttribute('aria-hidden','false'); }
        function closeModal(modal){
            modal.style.display='none';
            modal.setAttribute('aria-hidden','true');
            
            // Reset form fields when closing modals
            if(modal === profileModal){
                document.getElementById('profile-username').value = '';
                document.getElementById('profile-email').value = '';
                profileForm.onsubmit = null;
            }
        }

        // theme init
        (function initTheme(){
            const saved = localStorage.getItem('cloudforum-theme');
            if(saved === 'dark' || (!saved && window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches)){
                document.body.classList.add('dark-mode');
                themeToggle.checked = true;
            }
            themeToggle.addEventListener('change', ()=>{
                document.body.classList.toggle('dark-mode');
                localStorage.setItem('cloudforum-theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
            });
        })();

        // sample local data for demo (replace with API calls)
        function seedDemoData(){
            users = [
                {id:1,username:'admin',email:'admin@example.com',isAdmin:true},
                {id:2,username:'alice',email:'alice@example.com',isAdmin:false},
                {id:3,username:'bob',email:'bob@example.com',isAdmin:false}
            ];
            threads = [
                {id:1,title:'Welcome to CloudForum',posts:3,author:'admin',updated:'2025-09-16'},
                {id:2,title:'Announcements',posts:1,author:'admin',updated:'2025-09-15'}
            ];
            renderStats();
            renderThreads();
            renderUsers();
        }

        function renderStats(){
            document.getElementById('threads-count').textContent = threads.length;
            document.getElementById('posts-count').textContent = threads.reduce((s,t)=>s+t.posts,0);
            document.getElementById('users-count').textContent = users.length;
        }

        function renderThreads(){
            const el = document.getElementById('thread-list');
            el.innerHTML = '';
            threads.forEach(t=>{
                const div = document.createElement('div');
                div.className = 'thread';
                div.innerHTML = `<strong>${escapeHtml(t.title)}</strong> 
                                <div style="opacity:.7;font-size:.9rem">
                                    ${t.posts} posts • by ${escapeHtml(t.author)} • ${escapeHtml(t.updated)}
                                </div>`;
                el.appendChild(div);
            });
        }

        function renderUsers(){
            userListEl.innerHTML = '';
            users.forEach(u=>{
                const li = document.createElement('li');
                li.innerHTML = `<strong>${escapeHtml(u.username)}</strong> 
                               <span style="opacity:.7">(${escapeHtml(u.email)})</span>
                               ${u.isAdmin?'<span style="background:#ffd; padding:2px 6px;margin-left:8px;border-radius:4px;font-size:.8rem">admin</span>':''}
                               <div style="float:right">
                                   <button type="button" class="btn" data-id="${u.id}" data-action="edit">Edit</button>
                                   <button type="button" class="btn btn-danger" data-id="${u.id}" data-action="delete">Delete</button>
                               </div>`;
                userListEl.appendChild(li);
            });
            attachUserListHandlers();
        }

        function attachUserListHandlers(){
            userListEl.querySelectorAll('button').forEach(btn=>{
                btn.onclick = (e)=>{
                    const id = Number(btn.dataset.id);
                    const action = btn.dataset.action;
                    if(action==='delete'){
                        users = users.filter(u=>u.id!==id);
                        renderUsers(); renderStats();
                        showNotification('User deleted', true);
                    }else if(action==='edit'){
                        const u = users.find(x=>x.id===id);
                        if(u){
                            openModal(profileModal);
                            document.getElementById('profile-username').value = u.username;
                            document.getElementById('profile-email').value = u.email;
                            // for demo, save will update first match
                            profileForm.onsubmit = (ev)=>{
                                ev.preventDefault();
                                u.username = document.getElementById('profile-username').value || u.username;
                                u.email = document.getElementById('profile-email').value || u.email;
                                closeModal(profileModal);
                                renderUsers(); renderStats();
                                showNotification('User updated', true);
                            };
                            profileForm.addEventListener('submit', function tempHandler(ev){
                                ev.preventDefault();
                                u.username = document.getElementById('profile-username').value || u.username;
                                u.email = document.getElementById('profile-email').value || u.email;
                                closeModal(profileModal);
                                renderUsers();
                                renderStats();
                                showNotification('User updated', true);
                                
                                // Remove this temporary handler and restore default
                                profileForm.removeEventListener('submit', tempHandler);
                                profileForm.onsubmit = null;
                            });
                        }
                    }
                };
            });
        }

        // helpers
        function escapeHtml(s){ if(!s) return ''; return s.replace(/[&<>"']/g, c=> ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

        // auth UI
        function setCurrentUser(user){
            currentUser = user;
            if(user){
                usernameDisplay.textContent = user.username;
                userGreeting.style.display = 'inline-block';
                loginBtn.style.display = 'none';
                registerBtn.style.display = 'none';
                adminBtn.style.display = user.isAdmin ? 'inline-block' : 'none';
                adminPanel.style.display = user.isAdmin ? 'block' : 'none';
            }else{
                usernameDisplay.textContent = '';
                userGreeting.style.display = 'none';
                loginBtn.style.display = 'inline-block';
                registerBtn.style.display = 'inline-block';
                adminBtn.style.display = 'none';
                adminPanel.style.display = 'none';
            }
        }

        // events & form handlers
        document.addEventListener('DOMContentLoaded', ()=>{
            seedDemoData();
            setCurrentUser(null);

            // modal open/close
            loginBtn.addEventListener('click', ()=> openModal(loginModal));
            registerBtn.addEventListener('click', ()=> openModal(registerModal));
            closeLogin.addEventListener('click', ()=> closeModal(loginModal));
            closeRegister.addEventListener('click', ()=> closeModal(registerModal));
            closeProfile.addEventListener('click', ()=> closeModal(profileModal));
            cancelLogin.addEventListener('click', ()=> closeModal(loginModal));
            cancelRegister.addEventListener('click', ()=> closeModal(registerModal));
            cancelProfile.addEventListener('click', ()=> closeModal(profileModal));

            // login
            loginForm.addEventListener('submit', (e)=>{
                e.preventDefault();
                const em = document.getElementById('login-email').value.trim();
                const pw = document.getElementById('login-password').value;
                const user = users.find(u=>u.email===em);
                if(!user){ showNotification('Invalid credentials', false); return; }
                // demo: ignore password
                setCurrentUser(user);
                closeModal(loginModal);
                showNotification('Logged in', true);
            });

            // register
            registerForm.addEventListener('submit', (e)=>{
                e.preventDefault();
                const username = document.getElementById('register-username').value.trim();
                const email = document.getElementById('register-email').value.trim();
                if(!username || !email){ showNotification('Fill required fields', false); return; }
                const nextId = (users.reduce((m,u)=>Math.max(m,u.id),0) || 0) + 1;
                const newUser = {id:nextId,username, email, isAdmin:false};
                users.push(newUser);
                renderUsers(); renderStats();
                closeModal(registerModal);
                showNotification('Registered', true);
                setCurrentUser(newUser);
            });

            // logout & profile
            profileLink.addEventListener('click', (e)=>{ e.preventDefault(); openModal(profileModal); });
            logoutLink.addEventListener('click', (e)=>{ e.preventDefault(); setCurrentUser(null); showNotification('Logged out', true); });

            // profile save (when not editing a specific user)
            profileForm.addEventListener('submit', (e)=>{ e.preventDefault(); if(currentUser){ currentUser.username = document.getElementById('profile-username').value || currentUser.username; currentUser.email = document.getElementById('profile-email').value || currentUser.email; renderUsers(); renderStats(); showNotification('Profile saved', true); closeModal(profileModal);} });

            usersPerPageSelect.addEventListener('change', ()=>{ /* pagination placeholder */ });

            adminBtn.addEventListener('click', ()=>{ adminPanel.style.display = adminPanel.style.display === 'block' ? 'none' : 'block'; });

            // global click to close modals when clicking outside
            window.addEventListener('click', (ev)=>{
                [loginModal,registerModal,profileModal].forEach(m=>{
                    if(ev.target === m) closeModal(m);
                });
            });
        });
    </script>
</body>
</html>