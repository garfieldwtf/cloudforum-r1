<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CloudForum - Complete Admin System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4a6cf7;
            --secondary: #6c757d;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --info: #17a2b8;
            --light: #f8f9fa;
            --dark: #343a40;
            --background: #f5f7f9;
            --card-bg: #ffffff;
            --text: #333333;
            --border: #dee2e6;
        }

        .dark-mode {
            --background: #1a1d21;
            --card-bg: #2a2e35;
            --text: #e4e6eb;
            --border: #3e4248;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }
        
        body {
            background-color: var(--background);
            color: var(--text);
            line-height: 1.6;
            padding-bottom: 60px;
        }
        
        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary) 0%, #2a48a3 100%);
            color: white;
            padding: 1rem 0;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        header h1 {
            font-size: 2.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        header h1 i {
            font-size: 1.8rem;
        }
        
        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .btn {
            background-color: var(--primary);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            transition: background-color 0.3s, transform 0.2s;
        }
        
        .btn:hover {
            background-color: #3651b1;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background-color: var(--success);
        }
        
        .btn-success:hover {
            background-color: #218838;
        }
        
        .btn-danger {
            background-color: var(--danger);
        }
        
        .btn-danger:hover {
            background-color: #c82333;
        }
        
        .btn-warning {
            background-color: var(--warning);
            color: var(--dark);
        }
        
        .btn-warning:hover {
            background-color: #e0a800;
        }
        
        .btn-outline {
            background-color: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }
        
        .btn-outline:hover {
            background-color: var(--primary);
            color: white;
        }
        
        .btn-sm {
            padding: 5px 10px;
            font-size: 0.875rem;
        }
        
        .forum-stats {
            background-color: var(--card-bg);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-around;
            text-align: center;
            border: 1px solid var(--border);
        }
        
        .stat {
            padding: 10px;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
        }
        
        .stat-label {
            color: var(--secondary);
            font-size: 0.9rem;
        }
        
        .forum-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .thread-list {
            background-color: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
            border: 1px solid var(--border);
        }
        
        .thread {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .thread:hover {
            background-color: rgba(74, 108, 247, 0.05);
        }
        
        .thread:last-child {
            border-bottom: none;
        }
        
        .thread-icon {
            background-color: rgba(74, 108, 247, 0.1);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: var(--primary);
            font-size: 1.2rem;
        }
        
        .thread-content {
            flex: 1;
        }
        
        .thread-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 5px;
            text-decoration: none;
            display: block;
        }
        
        .thread-title:hover {
            color: var(--primary);
        }
        
        .thread-meta {
            font-size: 0.9rem;
            color: var(--secondary);
        }
        
        .thread-stats {
            display: flex;
            margin-top: 5px;
            gap: 15px;
        }
        
        .thread-stat {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
            color: var(--secondary);
        }
        
        .new-thread-form, .login-form, .register-form, .profile-form, .admin-user-form {
            background-color: var(--card-bg);
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
            border: 1px solid var(--border);
        }
        
        .form-title {
            margin-bottom: 20px;
            color: var(--text);
            font-size: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text);
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 1rem;
            transition: border-color 0.3s;
            background-color: var(--card-bg);
            color: var(--text);
        }
        
        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            border-color: var(--primary);
            outline: none;
        }
        
        .form-group textarea {
            min-height: 200px;
            resize: vertical;
        }
        
        .form-help {
            font-size: 0.875rem;
            color: var(--secondary);
            margin-top: 5px;
        }
        
        footer {
            text-align: center;
            margin-top: 50px;
            padding: 30px;
            color: var(--secondary);
            border-top: 1px solid var(--border);
        }
        
        .theme-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }
        
        .theme-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: var(--primary);
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 4px;
            background-color: var(--success);
            color: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: none;
            z-index: 1000;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: var(--card-bg);
            padding: 30px;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .close {
            float: right;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: var(--secondary);
        }
        
        .error {
            color: var(--danger);
            padding: 10px;
            background-color: rgba(220, 53, 69, 0.1);
            border-radius: 4px;
            margin: 10px 0;
        }
        
        .thread-view {
            display: none;
        }
        
        .post {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            position: relative;
        }
        
        .post:last-child {
            border-bottom: none;
        }
        
        .post-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            align-items: center;
        }
        
        .post-author {
            font-weight: 500;
            color: var(--primary);
        }
        
        .post-date {
            color: var(--secondary);
            font-size: 0.9rem;
        }
        
        .post-content {
            line-height: 1.6;
        }
        
        .post-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .admin-badge {
            background-color: var(--danger);
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-left: 8px;
        }
        
        .moderator-badge {
            background-color: var(--info);
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-left: 8px;
        }
        
        .admin-panel {
            background-color: var(--card-bg);
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
            border: 1px solid var(--border);
            display: none;
        }
        
        .admin-section {
            margin-bottom: 30px;
        }
        
        .admin-section h3 {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }
        
        .user-list, .post-list {
            list-style: none;
        }
        
        .user-item, .post-item {
            padding: 15px;
            border: 1px solid var(--border);
            border-radius: 4px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .user-info, .post-info {
            flex: 1;
        }
        
        .user-actions, .post-actions {
            display: flex;
            gap: 10px;
        }
        
        .connection-status {
            background-color: var(--card-bg);
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
            border: 1px solid var(--border);
        }
        
        .profile-menu {
            position: relative;
            display: inline-block;
        }
        
        .profile-dropdown {
            display: none;
            position: absolute;
            right: 0;
            top: 100%;
            background-color: var(--card-bg);
            min-width: 160px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            z-index: 1;
            border-radius: 4px;
            border: 1px solid var(--border);
            margin-top: 5px;
        }
        
        .profile-dropdown a {
            color: var(--text);
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            cursor: pointer;
        }
        
        .profile-dropdown a:hover {
            background-color: rgba(74, 108, 247, 0.1);
        }
        
        .profile-menu:hover .profile-dropdown {
            display: block;
        }
        
        .pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
        }
        
        .pagination-info {
            color: var(--secondary);
            font-size: 0.9rem;
        }
        
        .pagination-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .page-btn {
            padding: 5px 10px;
            border: 1px solid var(--border);
            background-color: var(--card-bg);
            color: var(--text);
            border-radius: 4px;
            cursor: pointer;
        }
        
        .page-btn.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .page-btn:hover:not(.active) {
            background-color: var(--light);
        }
        
        .items-per-page {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .forum-header {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }
            
            .thread {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .thread-icon {
                margin-bottom: 15px;
            }
            
            .forum-stats {
                flex-wrap: wrap;
            }
            
            .user-item, .post-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .user-actions, .post-actions {
                width: 100%;
                justify-content: flex-end;
            }
            
            .pagination {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="notification" id="notification"></div>
    
    <div id="login-modal" class="modal">
        <div class="modal-content">
            <span class="close" id="close-login">&times;</span>
            <h2><i class="fas fa-sign-in-alt"></i> Login to CloudForum</h2>
            <form id="login-form">
                <div class="form-group">
                    <label for="login-username">Username</label>
                    <input type="text" id="login-username" placeholder="Enter your username" required>
                </div>
                
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" placeholder="Enter your password" required>
                </div>
                
                <button type="submit" class="btn"><i class="fas fa-sign-in-alt"></i> Login</button>
            </form>
            <p style="margin-top: 20px; text-align: center;">
                Don't have an account? <a href="#" id="register-link">Register here</a>
            </p>
        </div>
    </div>
    
    <div id="register-modal" class="modal">
        <div class="modal-content">
            <span class="close" id="close-register">&times;</span>
            <h2><i class="fas fa-user-plus"></i> Register for CloudForum</h2>
            <form id="register-form">
                <div class="form-group">
                    <label for="register-username">Username</label>
                    <input type="text" id="register-username" placeholder="Choose a username" required>
                </div>
                
                <div class="form-group">
                    <label for="register-email">Email</label>
                    <input type="email" id="register-email" placeholder="Enter your email" required>
                </div>
                
                <div class="form-group">
                    <label for="register-password">Password</label>
                    <input type="password" id="register-password" placeholder="Create a password" required>
                </div>
                
                <div class="form-group">
                    <label for="register-password-confirm">Confirm Password</label>
                    <input type="password" id="register-password-confirm" placeholder="Confirm your password" required>
                </div>
                
                <button type="submit" class="btn btn-success"><i class="fas fa-user-plus"></i> Register</button>
            </form>
            <p style="margin-top: 20px; text-align: center;">
                Already have an account? <a href="#" id="login-link">Login here</a>
            </p>
        </div>
    </div>
    
    <div id="profile-modal" class="modal">
        <div class="modal-content">
            <span class="close" id="close-profile">&times;</span>
            <h2><i class="fas fa-user"></i> Edit Profile</h2>
            <form id="profile-form">
                <div class="form-group">
                    <label for="profile-username">Username</label>
                    <input type="text" id="profile-username" placeholder="Username" readonly>
                    <p class="form-help">Username cannot be changed</p>
                </div>
                
                <div class="form-group">
                    <label for="profile-email">Email</label>
                    <input type="email" id="profile-email" placeholder="Enter your email" required>
                </div>
                
                <div class="form-group">
                    <label for="profile-password">New Password (leave blank to keep current)</label>
                    <input type="password" id="profile-password" placeholder="New password">
                </div>
                
                <div class="form-group">
                    <label for="profile-password-confirm">Confirm New Password</label>
                    <input type="password" id="profile-password-confirm" placeholder="Confirm new password">
                </div>
                
                <div class="form-group">
                    <label for="profile-current-password">Current Password (required to save changes)</label>
                    <input type="password" id="profile-current-password" placeholder="Current password" required>
                </div>
                
                <button type="submit" class="btn"><i class="fas fa-save"></i> Save Changes</button>
            </form>
        </div>
    </div>
    
    <div id="admin-user-modal" class="modal">
        <div class="modal-content">
            <span class="close" id="close-admin-user">&times;</span>
            <h2><i class="fas fa-user-shield"></i> Create Admin User</h2>
            <form id="admin-user-form">
                <div class="form-group">
                    <label for="admin-username">Username</label>
                    <input type="text" id="admin-username" placeholder="Enter username" required>
                </div>
                
                <div class="form-group">
                    <label for="admin-email">Email</label>
                    <input type="email" id="admin-email" placeholder="Enter email" required>
                </div>
                
                <div class="form-group">
                    <label for="admin-password">Password</label>
                    <input type="password" id="admin-password" placeholder="Enter password" required>
                </div>
                
                <div class="form-group">
                    <label for="admin-password-confirm">Confirm Password</label>
                    <input type="password" id="admin-password-confirm" placeholder="Confirm password" required>
                </div>
                
                <button type="submit" class="btn btn-success"><i class="fas fa-user-plus"></i> Create Admin User</button>
            </form>
        </div>
    </div>
    
    <div id="edit-user-modal" class="modal">
        <div class="modal-content">
            <span class="close" id="close-edit-user">&times;</span>
            <h2><i class="fas fa-user-edit"></i> Edit User</h2>
            <form id="edit-user-form">
                <input type="hidden" id="edit-user-id">
                <div class="form-group">
                    <label for="edit-user-username">Username</label>
                    <input type="text" id="edit-user-username" readonly>
                    <p class="form-help">Username cannot be changed</p>
                </div>
                
                <div class="form-group">
                    <label for="edit-user-email">Email</label>
                    <input type="email" id="edit-user-email" required>
                </div>
                
                <div class="form-group">
                    <label for="edit-user-role">Role</label>
                    <select id="edit-user-role" required>
                        <option value="user">User</option>
                        <option value="moderator">Moderator</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="edit-user-password">New Password (leave blank to keep current)</label>
                    <input type="password" id="edit-user-password" placeholder="New password">
                </div>
                
                <button type="submit" class="btn"><i class="fas fa-save"></i> Save Changes</button>
            </form>
        </div>
    </div>
    
    <div id="edit-post-modal" class="modal">
        <div class="modal-content">
            <span class="close" id="close-edit-post">&times;</span>
            <h2><i class="fas fa-edit"></i> Edit Post</h2>
            <form id="edit-post-form">
                <input type="hidden" id="edit-post-id">
                <div class="form-group">
                    <label for="edit-post-title">Title</label>
                    <input type="text" id="edit-post-title" required>
                </div>
                
                <div class="form-group">
                    <label for="edit-post-content">Content</label>
                    <textarea id="edit-post-content" rows="6" required></textarea>
                </div>
                
                <button type="submit" class="btn"><i class="fas fa-save"></i> Save Changes</button>
            </form>
        </div>
    </div>
    
    <header>
        <div class="container header-content">
            <h1><i class="fas fa-database"></i> CloudForum R1</h1>
            <div class="header-actions">
                <div class="theme-toggle">
                    <i class="fas fa-sun"></i>
                    <label class="theme-switch">
                        <input type="checkbox" id="theme-toggle">
                        <span class="slider"></span>
                    </label>
                    <i class="fas fa-moon"></i>
                </div>
                <span id="user-greeting" style="display: none;">
                    <div class="profile-menu">
                        Welcome, <span id="username-display"></span>
                        <div class="profile-dropdown">
                            <a id="profile-link"><i class="fas fa-user"></i> Profile</a>
                            <a id="logout-link"><i class="fas fa-sign-out-alt"></i> Logout</a>
                        </div>
                    </div>
                </span>
                <button class="btn btn-success" id="admin-btn" style="display: none;"><i class="fas fa-cog"></i> Admin</button>
            </div>
        </div>
    </header>
    
    <main class="container">
        <div class="forum-stats">
            <div class="stat">
                <div class="stat-number" id="threads-count">0</div>
                <div class="stat-label">Threads</div>
            </div>
            <div class="stat">
                <div class="stat-number" id="posts-count">0</div>
                <div class="stat-label">Posts</div>
            </div>
            <div class="stat">
                <div class="stat-number" id="users-count">0</div>
                <div class="stat-label">Users</div>
            </div>
            <div class="stat">
                <div class="stat-number" id="online-count">1</div>
                <div class="stat-label">Online</div>
            </div>
        </div>
        
        <div id="admin-panel" class="admin-panel">
            <h2><i class="fas fa-cog"></i> Admin Panel</h2>
            
            <div class="admin-section">
                <h3>User Management</h3>
                <div class="form-group">
                    <button class="btn btn-success" id="create-admin-btn"><i class="fas fa-user-shield"></i> Create Admin User</button>
                    <p class="form-help">Create a new user with admin privileges</p>
                </div>
                
                <div class="items-per-page">
                    <label for="users-per-page">Users per page:</label>
                    <select id="users-per-page">
                        <option value="10">10</option>
                        <option value="20">20</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select>
                </div>
                
                <h4>All Users</h4>
                <ul class="user-list" id="user-list">
                    <li class="user-item">
                        <div class="user-info">
                            <strong>admin</strong> <span class="admin-badge">ADMIN</span>
                            <div>admin@example.com</div>
                        </div>
                        <div class="user-actions">
                            <button class="btn btn-sm btn-outline edit-user-btn" data-id="1" data-username="admin" data-email="admin@example.com" data-role="admin">Edit</button>
                            <button class="btn btn-sm btn-danger delete-user-btn" data-id="1" data-username="admin">Delete</button>
                        </div>
                    </li>
                </ul>
                
                <div class="pagination" id="user-pagination">
                    <div class="pagination-info" id="user-pagination-info">Showing 1-1 of 1 users</div>
                    <div class="pagination-controls">
                        <button class="page-btn" id="user-prev-btn" disabled>Previous</button>
                        <span class="page-btn active">1</span>
                        <button class="page-btn" id="user-next-btn" disabled>Next</button>
                    </div>
                </div>
            </div>
            
            <div class="admin-section">
                <h3>Content Moderation</h3>
                <div class="items-per-page">
                    <label for="posts-per-page">Posts per page:</label>
                    <select id="posts-per-page">
                        <option value="10">10</option>
                        <option value="20">20</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select>
                </div>
                
                <h4>Recent Posts</h4>
                <ul class="post-list" id="post-list">
                    <li class="post-item">
                        <div class="post-info">
                            <strong>Welcome to the forum!</strong>
                            <div>By: admin • 2 hours ago</div>
                        </div>
                        <div class="post-actions">
                            <button class="btn btn-sm btn-outline edit-post-btn" data-id="1" data-title="Welcome to the forum!" data-content="This is the first post in our forum. Welcome everyone!">Edit</button>
                            <button class="btn btn-sm btn-danger delete-post-btn" data-id="1">Delete</button>
                        </div>
                    </li>
                </ul>
                
                <div class="pagination" id="post-pagination">
                    <div class="pagination-info" id="post-pagination-info">Showing 1-1 of 1 posts</div>
                    <div class="pagination-controls">
                        <button class="page-btn" id="post-prev-btn" disabled>Previous</button>
                        <span class="page-btn active">1</span>
                        <button class="page-btn" id="post-next-btn" disabled>Next</button>
                    </div>
                </div>
            </div>
            
            <div class="admin-section">
                <h3>Database Management</h3>
                <button class="btn" id="init-db-btn"><i class="fas fa-database"></i> Initialize Database</button>
                <p class="form-help">Initialize the database with required tables</p>
            </div>
        </div>
        
        <div class="forum-header">
            <h2>Recent Discussions</h2>
            <button id="new-thread-btn" class="btn"><i class="fas fa-plus"></i> New Thread</button>
        </div>
        
        <div class="thread-list" id="thread-list">
            <div class="loading" id="loading">
                <i class="fas fa-spinner fa-spin"></i> Loading threads...
            </div>
        </div>
        
        <div id="thread-view" class="thread-view">
            <div class="forum-header">
                <h2 id="thread-view-title">Thread Title</h2>
                <button id="back-to-threads" class="btn btn-outline"><i class="fas fa-arrow-left"></i> Back to Threads</button>
            </div>
            
            <div id="thread-posts">
                <!-- Posts will be loaded here -->
            </div>
            
            <div id="reply-form" class="new-thread-form" style="display: none;">
                <h3 class="form-title">Post a Reply</h3>
                <form id="reply-form-content">
                    <div class="form-group">
                        <textarea id="reply-content" placeholder="Write your reply here..." required></textarea>
                    </div>
                    
                    <button type="submit" class="btn"><i class="fas fa-reply"></i> Post Reply</button>
                </form>
            </div>
        </div>
        
        <div id="new-thread-form" class="new-thread-form" style="display: none;">
            <h2 class="form-title">Create a New Thread</h2>
            <form id="thread-form">
                <div class="form-group">
                    <label for="thread-title">Title</label>
                    <input type="text" id="thread-title" placeholder="Enter a descriptive title for your thread" required>
                </div>
                
                <div class="form-group">
                    <label for="thread-content">Content</label>
                    <textarea id="thread-content" placeholder="Write your post here..." required></textarea>
                </div>
                
                <button type="submit" class="btn"><i class="fas fa-paper-plane"></i> Post Thread</button>
            </form>
        </div>
        
        <div id="connection-status" class="connection-status">
            <h2 class="form-title">Connection Status</h2>
            <div class="form-group">
                <label>API Endpoint:</label>
                <div class="code-block" style="background-color: var(--card-bg); color: var(--text); border: 1px solid var(--border);">
                    https://forum-api.garf.workers.dev/
                </div>
            </div>
            <div class="form-group">
                <label>Status:</label>
                <div id="api-status">Checking connection...</div>
            </div>
            <button id="test-api-btn" class="btn"><i class="fas fa-bolt"></i> Test API Connection</button>
        </div>
    </main>
    
    <footer>
        <div class="container">
            <p>© 2023 CloudForum R1. Connected to Cloudflare R1 Database via Worker.</p>
        </div>
    </footer>

    <script>
        // API base URL - your Cloudflare Worker URL
        const API_BASE = 'https://forum-api.garf.workers.dev';
        
        // Current user state
        let currentUser = null;
        let currentThread = null;
        let allUsers = [
            { id: 1, username: 'admin', email: 'admin@example.com', role: 'admin' }
        ];
        let allPosts = [
            { id: 1, title: 'Welcome to the forum!', author: 'admin', date: '2 hours ago', content: 'This is the first post in our forum. Welcome everyone!' }
        ];
        
        // Pagination state
        let userPage = 1;
        let postPage = 1;
        let usersPerPage = 10;
        let postsPerPage = 10;
        
        // Show notification function
        function showNotification(message, isSuccess = true) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.backgroundColor = isSuccess ? '#28a745' : '#dc3545';
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
        
        // Theme toggle functionality
        const themeToggle = document.getElementById('theme-toggle');
        const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
        
        // Set initial theme based on system preference
        if (prefersDarkScheme.matches) {
            document.body.classList.add('dark-mode');
            themeToggle.checked = true;
        }
        
        // Toggle theme when switch is clicked
        themeToggle.addEventListener('change', function() {
            document.body.classList.toggle('dark-mode');
        });
        
        // Check if user is logged in
        function checkLoginStatus() {
            const user = localStorage.getItem('currentUser');
            if (user) {
                currentUser = JSON.parse(user);
                updateUIForLoggedInUser();
            }
        }
        
        // Update UI for logged in user
        function updateUIForLoggedInUser() {
            document.getElementById('login-btn').style.display = 'none';
            document.getElementById('user-greeting').style.display = 'inline';
            document.getElementById('username-display').textContent = currentUser.username;
            
            // Show admin button if user is admin
            if (currentUser.role === 'admin') {
                document.getElementById('admin-btn').style.display = 'inline-flex';
                document.getElementById('admin-panel').style.display = 'block';
                document.getElementById('connection-status').style.display = 'block';
            } else {
                document.getElementById('connection-status').style.display = 'none';
            }
        }
        
        // Login functionality
        document.getElementById('login-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            
            try {
                // In a real app, this would call your authentication API
                // For demo purposes, we'll simulate a login
                let user = allUsers.find(u => u.username === username);
                
                if (!user) {
                    showNotification('User not found', false);
                    return;
                }
                
                // For demo, any password works
                currentUser = user;
                
                // Save to localStorage
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                // Update UI
                updateUIForLoggedInUser();
                
                // Close modal and show notification
                document.getElementById('login-modal').style.display = 'none';
                showNotification(`Welcome back, ${username}!`);
                
            } catch (error) {
                showNotification('Login failed: ' + error.message, false);
            }
        });
        
        // Logout functionality
        document.getElementById('logout-link').addEventListener('click', function() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            
            document.getElementById('login-btn').style.display = 'inline-flex';
            document.getElementById('user-greeting').style.display = 'none';
            document.getElementById('admin-btn').style.display = 'none';
            document.getElementById('admin-panel').style.display = 'none';
            
            showNotification('You have been logged out.');
        });
        
        // Register functionality
        document.getElementById('register-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const username = document.getElementById('register-username').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const passwordConfirm = document.getElementById('register-password-confirm').value;
            
            if (password !== passwordConfirm) {
                showNotification('Passwords do not match!', false);
                return;
            }
            
            // Check if username already exists
            if (allUsers.some(user => user.username === username)) {
                showNotification('Username already exists!', false);
                return;
            }
            
            try {
                // Create new user
                const newUser = {
                    id: Date.now(),
                    username: username,
                    email: email,
                    role: 'user'
                };
                
                // Add to users array
                allUsers.push(newUser);
                
                // Set as current user
                currentUser = newUser;
                
                // Save to localStorage
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                // Update UI
                updateUIForLoggedInUser();
                
                // Update user list if admin is viewing it
                if (document.getElementById('admin-panel').style.display === 'block') {
                    renderUserList();
                }
                
                // Close modal and show notification
                document.getElementById('register-modal').style.display = 'none';
                showNotification(`Account created successfully! Welcome, ${username}!`);
                
            } catch (error) {
                showNotification('Registration failed: ' + error.message, false);
            }
        });
        
        // Profile functionality
        document.getElementById('profile-link').addEventListener('click', function() {
            if (!currentUser) return;
            
            document.getElementById('profile-username').value = currentUser.username;
            document.getElementById('profile-email').value = currentUser.email;
            document.getElementById('profile-modal').style.display = 'flex';
        });
        
        document.getElementById('profile-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('profile-email').value;
            const newPassword = document.getElementById('profile-password').value;
            const confirmPassword = document.getElementById('profile-password-confirm').value;
            const currentPassword = document.getElementById('profile-current-password').value;
            
            if (newPassword && newPassword !== confirmPassword) {
                showNotification('New passwords do not match!', false);
                return;
            }
            
            // Update user info
            currentUser.email = email;
            
            // Update in allUsers array
            const userIndex = allUsers.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                allUsers[userIndex] = currentUser;
            }
            
            // Save to localStorage
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            
            // Close modal and show notification
            document.getElementById('profile-modal').style.display = 'none';
            showNotification('Profile updated successfully!');
        });
        
        // Create admin user functionality
        document.getElementById('create-admin-btn').addEventListener('click', function() {
            document.getElementById('admin-user-form').reset();
            document.getElementById('admin-user-modal').style.display = 'flex';
        });
        
        document.getElementById('admin-user-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('admin-username').value;
            const email = document.getElementById('admin-email').value;
            const password = document.getElementById('admin-password').value;
            const passwordConfirm = document.getElementById('admin-password-confirm').value;
            
            if (password !== passwordConfirm) {
                showNotification('Passwords do not match!', false);
                return;
            }
            
            // Check if username already exists
            if (allUsers.some(user => user.username === username)) {
                showNotification('Username already exists!', false);
                return;
            }
            
            // Create admin user
            const adminUser = {
                id: Date.now(),
                username: username,
                email: email,
                role: 'admin'
            };
            
            // Add to users array
            allUsers.push(adminUser);
            
            // Render updated user list
            renderUserList();
            
            // Close modal and show notification
            document.getElementById('admin-user-modal').style.display = 'none';
            showNotification(`Admin user ${username} created successfully!`);
        });
        
        // Edit user functionality
        function setupEditUserButtons() {
            document.querySelectorAll('.edit-user-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const userId = this.getAttribute('data-id');
                    const username = this.getAttribute('data-username');
                    const email = this.getAttribute('data-email');
                    const role = this.getAttribute('data-role');
                    
                    document.getElementById('edit-user-id').value = userId;
                    document.getElementById('edit-user-username').value = username;
                    document.getElementById('edit-user-email').value = email;
                    document.getElementById('edit-user-role').value = role;
                    
                    document.getElementById('edit-user-modal').style.display = 'flex';
                });
            });
        }
        
        document.getElementById('edit-user-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const userId = parseInt(document.getElementById('edit-user-id').value);
            const email = document.getElementById('edit-user-email').value;
            const role = document.getElementById('edit-user-role').value;
            const newPassword = document.getElementById('edit-user-password').value;
            
            // Find user and update
            const userIndex = allUsers.findIndex(u => u.id === userId);
            if (userIndex !== -1) {
                allUsers[userIndex].email = email;
                allUsers[userIndex].role = role;
                
                // If current user is being edited, update localStorage
                if (currentUser && currentUser.id === userId) {
                    currentUser.email = email;
                    currentUser.role = role;
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    updateUIForLoggedInUser();
                }
                
                // Render updated user list
                renderUserList();
                
                // Close modal and show notification
                document.getElementById('edit-user-modal').style.display = 'none';
                showNotification('User updated successfully!');
            }
        });
        
        // Delete user functionality
        function setupDeleteUserButtons() {
            document.querySelectorAll('.delete-user-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const userId = parseInt(this.getAttribute('data-id'));
                    const username = this.getAttribute('data-username');
                    
                    if (confirm(`Are you sure you want to delete user ${username}? This action cannot be undone.`)) {
                        // Remove user from array
                        allUsers = allUsers.filter(user => user.id !== userId);
                        
                        // If current user is deleted, log them out
                        if (currentUser && currentUser.id === userId) {
                            currentUser = null;
                            localStorage.removeItem('currentUser');
                            document.getElementById('login-btn').style.display = 'inline-flex';
                            document.getElementById('user-greeting').style.display = 'none';
                            document.getElementById('admin-btn').style.display = 'none';
                            document.getElementById('admin-panel').style.display = 'none';
                        }
                        
                        // Render updated user list
                        renderUserList();
                        
                        showNotification(`User ${username} has been deleted.`);
                    }
                });
            });
        }
        
        // Edit post functionality
        function setupEditPostButtons() {
            document.querySelectorAll('.edit-post-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const postId = this.getAttribute('data-id');
                    const title = this.getAttribute('data-title');
                    const content = this.getAttribute('data-content');
                    
                    document.getElementById('edit-post-id').value = postId;
                    document.getElementById('edit-post-title').value = title;
                    document.getElementById('edit-post-content').value = content;
                    
                    document.getElementById('edit-post-modal').style.display = 'flex';
                });
            });
        }
        
        document.getElementById('edit-post-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const postId = parseInt(document.getElementById('edit-post-id').value);
            const title = document.getElementById('edit-post-title').value;
            const content = document.getElementById('edit-post-content').value;
            
            // Find post and update
            const postIndex = allPosts.findIndex(p => p.id === postId);
            if (postIndex !== -1) {
                allPosts[postIndex].title = title;
                allPosts[postIndex].content = content;
                
                // Render updated post list
                renderPostList();
                
                // Close modal and show notification
                document.getElementById('edit-post-modal').style.display = 'none';
                showNotification('Post updated successfully!');
            }
        });
        
        // Delete post functionality
        function setupDeletePostButtons() {
            document.querySelectorAll('.delete-post-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const postId = parseInt(this.getAttribute('data-id'));
                    
                    if (confirm('Are you sure you want to delete this post? This action cannot be undone.')) {
                        // Remove post from array
                        allPosts = allPosts.filter(post => post.id !== postId);
                        
                        // Render updated post list
                        renderPostList();
                        
                        showNotification('Post has been deleted.');
                    }
                });
            });
        }
        
        // Render user list with pagination
        function renderUserList() {
            const userList = document.getElementById('user-list');
            userList.innerHTML = '';
            
            // Calculate pagination
            const startIndex = (userPage - 1) * usersPerPage;
            const endIndex = Math.min(startIndex + usersPerPage, allUsers.length);
            const paginatedUsers = allUsers.slice(startIndex, endIndex);
            
            // Update pagination info
            document.getElementById('user-pagination-info').textContent = 
                `Showing ${startIndex + 1}-${endIndex} of ${allUsers.length} users`;
            
            // Update pagination controls
            document.getElementById('user-prev-btn').disabled = userPage === 1;
            document.getElementById('user-next-btn').disabled = endIndex >= allUsers.length;
            
            // Clear existing page buttons
            const paginationControls = document.querySelector('#user-pagination .pagination-controls');
            paginationControls.innerHTML = '';
            
            // Add previous button
            const prevBtn = document.createElement('button');
            prevBtn.className = 'page-btn';
            prevBtn.id = 'user-prev-btn';
            prevBtn.textContent = 'Previous';
            prevBtn.disabled = userPage === 1;
            prevBtn.addEventListener('click', () => {
                if (userPage > 1) {
                    userPage--;
                    renderUserList();
                }
            });
            paginationControls.appendChild(prevBtn);
            
            // Add page buttons
            const totalPages = Math.ceil(allUsers.length / usersPerPage);
            for (let i = 1; i <= totalPages; i++) {
                const pageBtn = document.createElement('span');
                pageBtn.className = `page-btn ${i === userPage ? 'active' : ''}`;
                pageBtn.textContent = i;
                pageBtn.addEventListener('click', () => {
                    userPage = i;
                    renderUserList();
                });
                paginationControls.appendChild(pageBtn);
            }
            
            // Add next button
            const nextBtn = document.createElement('button');
            nextBtn.className = 'page-btn';
            nextBtn.id = 'user-next-btn';
            nextBtn.textContent = 'Next';
            nextBtn.disabled = endIndex >= allUsers.length;
            nextBtn.addEventListener('click', () => {
                if (endIndex < allUsers.length) {
                    userPage++;
                    renderUserList();
                }
            });
            paginationControls.appendChild(nextBtn);
            
            // Render users
            paginatedUsers.forEach(user => {
                const userItem = document.createElement('li');
                userItem.className = 'user-item';
                
                let roleBadge = '';
                if (user.role === 'admin') {
                    roleBadge = '<span class="admin-badge">ADMIN</span>';
                } else if (user.role === 'moderator') {
                    roleBadge = '<span class="moderator-badge">MOD</span>';
                }
                
                userItem.innerHTML = `
                    <div class="user-info">
                        <strong>${user.username}</strong> ${roleBadge}
                        <div>${user.email}</div>
                    </div>
                    <div class="user-actions">
                        <button class="btn btn-sm btn-outline edit-user-btn" data-id="${user.id}" data-username="${user.username}" data-email="${user.email}" data-role="${user.role}">Edit</button>
                        <button class="btn btn-sm btn-danger delete-user-btn" data-id="${user.id}" data-username="${user.username}">Delete</button>
                    </div>
                `;
                
                userList.appendChild(userItem);
            });
            
            // Set up event listeners for the new buttons
            setupEditUserButtons();
            setupDeleteUserButtons();
        }
        
        // Render post list with pagination
        function renderPostList() {
            const postList = document.getElementById('post-list');
            postList.innerHTML = '';
            
            // Calculate pagination
            const startIndex = (postPage - 1) * postsPerPage;
            const endIndex = Math.min(startIndex + postsPerPage, allPosts.length);
            const paginatedPosts = allPosts.slice(startIndex, endIndex);
            
            // Update pagination info
            document.getElementById('post-pagination-info').textContent = 
                `Showing ${startIndex + 1}-${endIndex} of ${allPosts.length} posts`;
            
            // Update pagination controls
            document.getElementById('post-prev-btn').disabled = postPage === 1;
            document.getElementById('post-next-btn').disabled = endIndex >= allPosts.length;
            
            // Clear existing page buttons
            const paginationControls = document.querySelector('#post-pagination .pagination-controls');
            paginationControls.innerHTML = '';
            
            // Add previous button
            const prevBtn = document.createElement('button');
            prevBtn.className = 'page-btn';
            prevBtn.id = 'post-prev-btn';
            prevBtn.textContent = 'Previous';
            prevBtn.disabled = postPage === 1;
            prevBtn.addEventListener('click', () => {
                if (postPage > 1) {
                    postPage--;
                    renderPostList();
                }
            });
            paginationControls.appendChild(prevBtn);
            
            // Add page buttons
            const totalPages = Math.ceil(allPosts.length / postsPerPage);
            for (let i = 1; i <= totalPages; i++) {
                const pageBtn = document.createElement('span');
                pageBtn.className = `page-btn ${i === postPage ? 'active' : ''}`;
                pageBtn.textContent = i;
                pageBtn.addEventListener('click', () => {
                    postPage = i;
                    renderPostList();
                });
                paginationControls.appendChild(pageBtn);
            }
            
            // Add next button
            const nextBtn = document.createElement('button');
            nextBtn.className = 'page-btn';
            nextBtn.id = 'post-next-btn';
            nextBtn.textContent = 'Next';
            nextBtn.disabled = endIndex >= allPosts.length;
            nextBtn.addEventListener('click', () => {
                if (endIndex < allPosts.length) {
                    postPage++;
                    renderPostList();
                }
            });
            paginationControls.appendChild(nextBtn);
            
            // Render posts
            paginatedPosts.forEach(post => {
                const postItem = document.createElement('li');
                postItem.className = 'post-item';
                
                postItem.innerHTML = `
                    <div class="post-info">
                        <strong>${post.title}</strong>
                        <div>By: ${post.author} • ${post.date}</div>
                    </div>
                    <div class="post-actions">
                        <button class="btn btn-sm btn-outline edit-post-btn" data-id="${post.id}" data-title="${post.title}" data-content="${post.content}">Edit</button>
                        <button class="btn btn-sm btn-danger delete-post-btn" data-id="${post.id}">Delete</button>
                    </div>
                `;
                
                postList.appendChild(postItem);
            });
            
            // Set up event listeners for the new buttons
            setupEditPostButtons();
            setupDeletePostButtons();
        }
        
        // Initialize database
        document.getElementById('init-db-btn').addEventListener('click', async function() {
            try {
                const response = await fetch(`${API_BASE}/api/init`, {
                    method: 'POST'
                });
                
                if (response.ok) {
                    showNotification('Database initialized successfully!');
                } else {
                    showNotification('Database initialization failed', false);
                }
            } catch (error) {
                showNotification('Error initializing database: ' + error.message, false);
            }
        });
        
        // Toggle new thread form
        const newThreadBtn = document.getElementById('new-thread-btn');
        const newThreadForm = document.getElementById('new-thread-form');
        
        newThreadBtn.addEventListener('click', function() {
            if (!currentUser) {
                showNotification('Please login to create a thread', false);
                document.getElementById('login-modal').style.display = 'flex';
                return;
            }
            
            if (newThreadForm.style.display === 'none') {
                newThreadForm.style.display = 'block';
                window.scrollTo({
                    top: newThreadForm.offsetTop - 20,
                    behavior: 'smooth'
                });
            } else {
                newThreadForm.style.display = 'none';
            }
        });
        
        // Toggle login modal
        const loginBtn = document.getElementById('login-btn');
        const loginModal = document.getElementById('login-modal');
        const closeLogin = document.getElementById('close-login');
        
        loginBtn.addEventListener('click', function() {
            loginModal.style.display = 'flex';
        });
        
        closeLogin.addEventListener('click', function() {
            loginModal.style.display = 'none';
        });
        
        // Toggle register modal
        const registerBtn = document.getElementById('register-link');
        const registerModal = document.getElementById('register-modal');
        const closeRegister = document.getElementById('close-register');
        const loginLink = document.getElementById('login-link');
        
        registerBtn.addEventListener('click', function(e) {
            e.preventDefault();
            loginModal.style.display = 'none';
            registerModal.style.display = 'flex';
        });
        
        loginLink.addEventListener('click', function(e) {
            e.preventDefault();
            registerModal.style.display = 'none';
            loginModal.style.display = 'flex';
        });
        
        // Close modals
        closeRegister.addEventListener('click', function() {
            registerModal.style.display = 'none';
        });
        
        document.getElementById('close-profile').addEventListener('click', function() {
            document.getElementById('profile-modal').style.display = 'none';
        });
        
        document.getElementById('close-admin-user').addEventListener('click', function() {
            document.getElementById('admin-user-modal').style.display = 'none';
        });
        
        document.getElementById('close-edit-user').addEventListener('click', function() {
            document.getElementById('edit-user-modal').style.display = 'none';
        });
        
        document.getElementById('close-edit-post').addEventListener('click', function() {
            document.getElementById('edit-post-modal').style.display = 'none';
        });
        
        window.addEventListener('click', function(event) {
            if (event.target === loginModal) {
                loginModal.style.display = 'none';
            }
            if (event.target === registerModal) {
                registerModal.style.display = 'none';
            }
            if (event.target === document.getElementById('profile-modal')) {
                document.getElementById('profile-modal').style.display = 'none';
            }
            if (event.target === document.getElementById('admin-user-modal')) {
                document.getElementById('admin-user-modal').style.display = 'none';
            }
            if (event.target === document.getElementById('edit-user-modal')) {
                document.getElementById('edit-user-modal').style.display = 'none';
            }
            if (event.target === document.getElementById('edit-post-modal')) {
                document.getElementById('edit-post-modal').style.display = 'none';
            }
        });
        
        // Test API connection
        const testApiBtn = document.getElementById('test-api-btn');
        const apiStatus = document.getElementById('api-status');
        
        testApiBtn.addEventListener('click', async function() {
            apiStatus.innerHTML = 'Testing connection...';
            
            try {
                const response = await fetch(`${API_BASE}/api/threads`);
                if (response.ok) {
                    apiStatus.innerHTML = '<span style="color: green;">Connected successfully!</span>';
                    showNotification('API connection successful!');
                } else {
                    apiStatus.innerHTML = `<span style="color: red;">Error: ${response.status} ${response.statusText}</span>`;
                    showNotification('API connection failed', false);
                }
            } catch (error) {
                apiStatus.innerHTML = `<span style="color: red;">Error: ${error.message}</span>`;
                showNotification('API connection failed', false);
            }
        });
        
        // Handle thread form submission
        const threadForm = document.getElementById('thread-form');
        
        threadForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!currentUser) {
                showNotification('Please login to create a thread', false);
                return;
            }
            
            const title = document.getElementById('thread-title').value;
            const content = document.getElementById('thread-content').value;
            
            if (title && content) {
                try {
                    const response = await fetch(`${API_BASE}/api/threads`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ 
                            title, 
                            content, 
                            author: currentUser.username 
                        }),
                    });
                    
                    if (!response.ok) {
                        throw new Error(`Server returned ${response.status}: ${response.statusText}`);
                    }
                    
                    const result = await response.json();
                    
                    // Add the thread to our local array
                    const newPost = {
                        id: result.id || Date.now(),
                        title: title,
                        author: currentUser.username,
                        date: 'just now',
                        content: content
                    };
                    
                    allPosts.unshift(newPost);
                    
                    // Add the thread to the UI
                    const threadList = document.getElementById('thread-list');
                    const threadEl = document.createElement('div');
                    threadEl.className = 'thread';
                    threadEl.dataset.id = newPost.id;
                    threadEl.innerHTML = `
                        <div class="thread-icon">
                            <i class="fas fa-comment"></i>
                        </div>
                        <div class="thread-content">
                            <div class="thread-title">${title}</div>
                            <div class="thread-meta">Started by <strong>${currentUser.username}</strong>, just now</div>
                            <div class="thread-stats">
                                <span class="thread-stat"><i class="fas fa-comments"></i> 0 replies</span>
                                <span class="thread-stat"><i class="fas fa-eye"></i> 0 views</span>
                            </div>
                        </div>
                    `;
                    
                    // Add click event to view thread
                    threadEl.addEventListener('click', function() {
                        viewThread(newPost.id, title);
                    });
                    
                    threadList.prepend(threadEl);
                    
                    // Update stats
                    document.getElementById('threads-count').textContent = 
                        parseInt(document.getElementById('threads-count').textContent) + 1;
                    
                    // Reset form and hide it
                    threadForm.reset();
                    newThreadForm.style.display = 'none';
                    
                    // Show success message
                    showNotification('Your thread has been posted successfully!');
                    
                } catch (error) {
                    console.error('Error creating thread:', error);
                    showNotification('Error creating thread: ' + error.message, false);
                }
            }
        });
        
        // View thread function
        function viewThread(threadId, threadTitle) {
            currentThread = { id: threadId, title: threadTitle };
            document.getElementById('thread-view-title').textContent = threadTitle;
            document.getElementById('thread-list').style.display = 'none';
            document.getElementById('thread-view').style.display = 'block';
            document.getElementById('new-thread-form').style.display = 'none';
            
            // Load thread content
            loadThreadContent(threadId);
        }
        
        // Back to threads
        document.getElementById('back-to-threads').addEventListener('click', function() {
            document.getElementById('thread-view').style.display = 'none';
            document.getElementById('thread-list').style.display = 'block';
            document.getElementById('reply-form').style.display = 'none';
            currentThread = null;
        });
        
        // Load thread content
        async function loadThreadContent(threadId) {
            const threadPosts = document.getElementById('thread-posts');
            threadPosts.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> Loading thread...</div>';
            
            try {
                // In a real app, this would fetch from your API
                // For demo, we'll simulate loading
                setTimeout(() => {
                    const post = allPosts.find(p => p.id === threadId) || {
                        title: 'Demo Thread',
                        author: 'admin',
                        date: '2 hours ago',
                        content: 'This is the content of the thread. In a real application, this would be loaded from the database.'
                    };
                    
                    threadPosts.innerHTML = `
                        <div class="post">
                            <div class="post-header">
                                <span class="post-author">${post.author} <span class="admin-badge">ADMIN</span></span>
                                <span class="post-date">${post.date}</span>
                            </div>
                            <div class="post-content">
                                <p>${post.content}</p>
                            </div>
                            ${currentUser && currentUser.role === 'admin' ? `
                            <div class="post-actions">
                                <button class="btn btn-sm btn-outline edit-post-btn" data-id="${threadId}" data-title="${post.title}" data-content="${post.content}"><i class="fas fa-edit"></i> Edit</button>
                                <button class="btn btn-sm btn-danger delete-post-btn" data-id="${threadId}"><i class="fas fa-trash"></i> Delete</button>
                            </div>
                            ` : ''}
                        </div>
                    `;
                    
                    // Set up event listeners for edit/delete buttons
                    if (currentUser && currentUser.role === 'admin') {
                        setupEditPostButtons();
                        setupDeletePostButtons();
                    }
                    
                    // Show reply form if user is logged in
                    if (currentUser) {
                        document.getElementById('reply-form').style.display = 'block';
                    }
                }, 1000);
            } catch (error) {
                threadPosts.innerHTML = `<div class="error">Error loading thread: ${error.message}</div>`;
            }
        }
        
        // Handle reply form submission
        document.getElementById('reply-form-content').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!currentUser) {
                showNotification('Please login to post a reply', false);
                return;
            }
            
            const content = document.getElementById('reply-content').value;
            
            if (content) {
                try {
                    // In a real app, this would call your API
                    // For demo, we'll simulate posting a reply
                    const threadPosts = document.getElementById('thread-posts');
                    const replyEl = document.createElement('div');
                    replyEl.className = 'post';
                    replyEl.innerHTML = `
                        <div class="post-header">
                            <span class="post-author">${currentUser.username} ${currentUser.role === 'admin' ? '<span class="admin-badge">ADMIN</span>' : ''}</span>
                            <span class="post-date">just now</span>
                        </div>
                        <div class="post-content">
                            <p>${content}</p>
                        </div>
                        ${currentUser.role === 'admin' ? `
                        <div class="post-actions">
                            <button class="btn btn-sm btn-outline"><i class="fas fa-edit"></i> Edit</button>
                            <button class="btn btn-sm btn-danger"><i class="fas fa-trash"></i> Delete</button>
                        </div>
                        ` : ''}
                    `;
                    threadPosts.appendChild(replyEl);
                    
                    // Reset form
                    document.getElementById('reply-content').value = '';
                    
                    // Show success message
                    showNotification('Your reply has been posted successfully!');
                    
                } catch (error) {
                    console.error('Error posting reply:', error);
                    showNotification('Error posting reply: ' + error.message, false);
                }
            }
        });
        
        // Load threads from API
        async function loadThreads() {
            const loadingElement = document.getElementById('loading');
            const threadList = document.getElementById('thread-list');
            
            try {
                loadingElement.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading threads from database...';
                
                const response = await fetch(`${API_BASE}/api/threads`);
                
                if (!response.ok) {
                    throw new Error(`API returned ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                // Remove loading indicator
                loadingElement.style.display = 'none';
                
                if (data.results && data.results.length > 0) {
                    // Display threads from database
                    data.results.forEach(thread => {
                        const threadEl = document.createElement('div');
                        threadEl.className = 'thread';
                        threadEl.dataset.id = thread.id;
                        threadEl.innerHTML = `
                            <div class="thread-icon">
                                <i class="fas fa-question"></i>
                            </div>
                            <div class="thread-content">
                                <div class="thread-title">${thread.title}</div>
                                <div class="thread-meta">Started by <strong>${thread.author}</strong>, ${new Date(thread.created_at).toLocaleDateString()}</div>
                                <div class="thread-stats">
                                    <span class="thread-stat"><i class="fas fa-comments"></i> 0 replies</span>
                                    <span class="thread-stat"><i class="fas fa-eye"></i> 0 views</span>
                                </div>
                            </div>
                        `;
                        
                        // Add click event to view thread
                        threadEl.addEventListener('click', function() {
                            viewThread(thread.id, thread.title);
                        });
                        
                        threadList.appendChild(threadEl);
                    });
                    
                    // Update stats
                    document.getElementById('threads-count').textContent = data.results.length;
                    apiStatus.innerHTML = '<span style="color: green;">Connected successfully! Loaded threads from database.</span>';
                } else {
                    // No threads in database
                    threadList.innerHTML = `
                        <div class="thread">
                            <div class="thread-icon">
                                <i class="fas fa-info-circle"></i>
                            </div>
                            <div class="thread-content">
                                <div class="thread-title">No threads yet</div>
                                <div class="thread-meta">Be the first to create a thread!</div>
                            </div>
                        </div>
                    `;
                    apiStatus.innerHTML = '<span style="color: green;">Connected successfully! No threads in database yet.</span>';
                }
                
            } catch (error) {
                console.error('Error loading threads:', error);
                loadingElement.innerHTML = `
                    <div class="error">
                        <i class="fas fa-exclamation-triangle"></i> Error loading threads: ${error.message}
                    </div>
                    <div style="text-align: center; margin-top: 10px;">
                        <button onclick="loadThreads()" class="btn"><i class="fas fa-redo"></i> Try Again</button>
                    </div>
                `;
                apiStatus.innerHTML = `<span style="color: red;">Error: ${error.message}</span>`;
            }
        }
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            checkLoginStatus();
            loadThreads();
            
            // Render initial user and post lists
            renderUserList();
            renderPostList();
            
            // Admin button toggle
            document.getElementById('admin-btn').addEventListener('click', function() {
                const adminPanel = document.getElementById('admin-panel');
                adminPanel.style.display = adminPanel.style.display === 'none' ? 'block' : 'none';
            });
            
            // Hide connection status for non-admin users by default
            if (!currentUser || currentUser.role !== 'admin') {
                document.getElementById('connection-status').style.display = 'none';
            }
            
            // Items per page change handlers
            document.getElementById('users-per-page').addEventListener('change', function() {
                usersPerPage = parseInt(this.value);
                userPage = 1;
                renderUserList();
            });
            
            document.getElementById('posts-per-page').addEventListener('change', function() {
                postsPerPage = parseInt(this.value);
                postPage = 1;
                renderPostList();
            });
        });
    </script>
</body>
</html>